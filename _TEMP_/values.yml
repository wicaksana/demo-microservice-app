global:
  enabled: true
  name: consul
  datacenter: gcp-dc1
  image: hashicorp/consul-enterprise:1.21.6-ent-ubi
  imageK8S: hashicorp/consul-k8s-control-plane:1.8.3-ubi
  imageConsulDataplane: hashicorp/consul-dataplane:1.8.3-ubi
  logLevel: debug

  adminPartitions:
    enabled: true
    name: "default" 

  enterpriseLicense:
    secretName: consul-ent-license
    secretKey: key

  tls:
    enabled: true
    enableAutoEncrypt: true
    verify: false  # Set to false for testing, true for production
    caCert:
      secretName: consul-ca-cert
      secretKey: tls.crt
    caKey:
      secretName: consul-ca-key
      secretKey: tls.key

  acls:
    manageSystemACLs: true
    bootstrapToken:
      secretName: consul-bootstrap-token
      secretKey: token

  enableConsulNamespaces: true

  peering:
    enabled: true

  metrics:
    enableTelemetryCollector: false
    enabled: true
    enableAgentMetrics: true
    enableGatewayMetrics: true
    agentMetricsRetentionTime: "12h"

  openshift:
    enabled: true

  imagePullSecrets:
    - name: 16740869-soko01-pull-secret

  resources:
    requests:
      memory: "50Mi"
      cpu: "50m"
    limits:
      memory: "50Mi"
      cpu: "50m"

externalServers:
  enabled: true
  hosts:
    - "34.10.36.135"
    - "34.68.8.110"
    - "34.61.227.179"
  httpsPort: 8501
  grpcPort: 8502
  tlsServerName: server.dc1.consul
  # Get this from: oc whoami --show-server
  k8sAuthMethodHost: https://redacted.openshiftapps.com:6443
  # Skip server watch to prevent switching to internal IPs
  skipServerWatch: true

server:
  enabled: false

# Client Configuration (disabled for dataplane mode)
client:
  enabled: false
  grpc: true

# DNS Configuration
dns:
  enabled: true
  enableRedirection: true

# UI Configuration
ui:
  enabled: true
  metrics:
    enabled: true
    provider: "prometheus"

# Connect Inject Configuration
connectInject:
  enabled: true
  replicas: 1

  # Transparent Proxy
  transparentProxy:
    defaultEnabled: true

  # CNI Configuration for OpenShift
  cni:
    enabled: true
    namespace: "consul"
    cniBinDir: "/var/lib/cni/bin"
    cniNetDir: "/etc/kubernetes/cni/net.d"
    multus: true

  # Namespace mirroring
  consulNamespaces:
    mirroringK8S: true

  # Namespace selection - only inject into labeled namespaces
  namespaceSelector: |
    matchExpressions:
      - key: bofa.com/esm
        operator: In
        values:
          - enabled

  # Denied namespaces
  k8sDenyNamespaces:
    - default
    - kube-system
    - kube-public
    - kube-node-lease

  # Sidecar proxy resources
  sidecarProxy:
    resources:
      requests:
        memory: 128Mi
        cpu: 100m
      limits:
        memory: 128Mi
        cpu: 100m

  # Init container resources
  initContainer:
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "150Mi"
        cpu: "100m"

  # Metrics configuration
  metrics:
    defaultEnabled: true
    defaultEnableMerging: true
    defaultMergedMetricsPort: '20100'
    defaultPrometheusScrapePort: '20200'
    defaultPrometheusScrapePath: '/metrics'

  # Resources for connect inject
  resources:
    requests:
      memory: "300Mi"
      cpu: "250m"
    limits:
      memory: "4Gi"
      cpu: "2"

  # Failure policy
  failurePolicy: "Ignore"

  # API Gateway configuration
  apiGateway:
    manageExternalCRDs: true
    managedGatewayClass:
      resources:
        requests:
          memory: "500Mi"
          cpu: "100m"
        limits:
          memory: "1000Mi"
          cpu: "500m"
      serviceType: "ClusterIP"


# Mesh Gateway Configuration
meshGateway:
  enabled: true
  replicas: 1
  service:
    type: NodePort
    nodePort: 31443
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"
  annotations: {}

# Ingress Gateways
ingressGateways:
  enabled: false

# Terminating Gateways
terminatingGateways:
  enabled: false
